<!DOCTYPE project []>

<project name="vhdllab" basedir="." default="package">

  <property name="app.name" value="vhdllab"/>
  
  <property name="build.dir" value="build"/>
  <property name="lib.dir" value="libs"/>
  <property name="jlib.dir" value="jlibs"/>
  <property name="jlib-tests.dir" value="${jlib.dir}/tests"/>
  <property name="doc.dir" value="doc"/>

  <path id="src.class.path">
    <fileset dir="${lib.dir}">
      <include name="junit.jar"/>
      <include name="servlet-api.jar"/>
      <include name="plugin.jar"/>
    </fileset>
    <pathelement path="${build.dir}/dao"/>
    <pathelement path="${build.dir}/service"/>
    <pathelement path="${build.dir}/web/onServer"/>
    <pathelement path="${build.dir}/web/onClient"/>
    <pathelement path="${build.dir}/tests/dao"/>
    <pathelement path="${build.dir}/tests/service"/>
    <pathelement path="${build.dir}/tests/web/onServer"/>
    <pathelement path="${build.dir}/tests/web/onClient"/>
  </path>

 <target name="init">
    <available file="${lib.dir}/junit.jar" property="junit.jar.present"/>
    <fail unless="junit.jar.present">
      "${lib.dir}/junit.jar" file is not present. You can download it from http://www.junit.org.
    </fail>

    <available file="${lib.dir}/plugin.jar" property="plugin.jar.present"/>
    <fail unless="plugin.jar.present">
      "${lib.dir}/plugin.jar" file is not present. You can copy it from $JAVA_HOME/jre/lib/plugin.jar or $JRE_HOME/lib/plugin.jar.
    </fail>

    <available file="${lib.dir}/servlet-api.jar" property="servlet-api.jar.present"/>
    <fail unless="servlet-api.jar.present">
      "${lib.dir}/servlet-api.jar" file is not present. You can copy it from $CATALINA_HOME/common/lib/servlet-api.jar.
    </fail>

    <tstamp/>
    
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${build.dir}/web/onClient"/>
    <mkdir dir="${build.dir}/web/onServer"/>
    <mkdir dir="${build.dir}/service"/>
    <mkdir dir="${build.dir}/dao"/>
    <mkdir dir="${build.dir}/tests/web/onClient"/>
    <mkdir dir="${build.dir}/tests/web/onServer"/>
    <mkdir dir="${build.dir}/tests/service"/>
    <mkdir dir="${build.dir}/tests/dao"/>
    <mkdir dir="${jlib.dir}"/>
    <mkdir dir="${jlib-tests.dir}"/>
 </target>

  <target name="clean">
   <delete quiet="true" includeEmptyDirs="true">
      <fileset dir="${build.dir}"/>
      <fileset dir="${jlib.dir}"/>
      <fileset dir="${jlib-tests.dir}"/>
      <fileset dir="${doc.dir}"/>
    </delete>
  </target>

  <target name="compile-dao" depends="init">
    <javac destdir="${build.dir}/dao" includes="**/*java" includeAntRuntime="false" debug="true" debuglevel="lines,vars,source" encoding="UTF-8">
      <src path="src/dao"/>
      <classpath refid="src.class.path"/>
    </javac>
  </target>

  <target name="compile-service" depends="compile-dao">
    <javac destdir="${build.dir}/service" includes="**/*java" includeAntRuntime="false" debug="true" debuglevel="lines,vars,source" encoding="UTF-8">
      <src path="src/service"/>
      <classpath refid="src.class.path"/>
    </javac>
  </target>

  <target name="compile-web-onServer" depends="compile-service">
    <javac destdir="${build.dir}/web/onServer" includes="**/*java" includeAntRuntime="false" debug="true" debuglevel="lines,vars,source" encoding="UTF-8">
      <src path="src/web/onServer"/>
      <classpath refid="src.class.path"/>
    </javac>
  </target>
	
  <target name="compile-web-onClient" depends="compile-service">
    <javac destdir="${build.dir}/web/onClient" includes="**/*java" includeAntRuntime="false" debug="true" debuglevel="lines,vars,source" encoding="UTF-8">
      <src path="src/web/onClient"/>
      <src path="src/web/onServer/hr/fer/zemris/ajax/shared"/>
      <classpath refid="src.class.path"/>
    </javac>
  </target>

  <target name="package-dao" depends="compile-dao">
    <jar destfile="${jlib.dir}/${app.name}-dao.jar">
      <fileset dir="${build.dir}/dao" includes="**/*.class"/>
    </jar>
  </target>

  <target name="package-service" depends="compile-service">
    <jar destfile="${jlib.dir}/${app.name}-service.jar">
      <fileset dir="${build.dir}/service" includes="**/*.class"/>
    </jar>
  </target>

  <target name="package-web-onServer" depends="compile-web-onServer">
  	<jar destfile="${jlib.dir}/${app.name}-web-onServer.jar">
  	  <fileset dir="${build.dir}/web/onServer" includes="**/*.class"/>
  	</jar>
  </target>
  
  <target name="package-web-onClient" depends="compile-web-onClient">
  	<jar destfile="${jlib.dir}/${app.name}-web-onClient.jar">
  	  <fileset dir="${build.dir}/web/onClient" includes="**/*.class"/>
	  <fileset dir="${build.dir}/web/onServer" includes="hr/fer/zemris/ajax/shared/**/*.class"/>
  	</jar>
  </target>
  
  <target name="compile-tests-dao" depends="compile-dao">
    <javac destdir="${build.dir}/tests/dao" includes="**/*java" includeAntRuntime="false" debug="true" debuglevel="lines,vars,source" encoding="UTF-8">
      <src path="src/tests/dao"/>
      <classpath refid="src.class.path"/>
    </javac>
  </target>
	
  <target name="compile-tests-service" depends="compile-service">
    <javac destdir="${build.dir}/tests/service" includes="**/*java" includeAntRuntime="false" debug="true" debuglevel="lines,vars,source" encoding="UTF-8">
      <src path="src/tests/service"/>
      <classpath refid="src.class.path"/>
    </javac>
  </target>

  <target name="compile-tests-web-onServer" depends="compile-web-onServer">
    <javac destdir="${build.dir}/tests/web/onServer" includes="**/*java" includeAntRuntime="false" debug="true" debuglevel="lines,vars,source" encoding="UTF-8">
      <src path="src/tests/web/onServer"/>
      <classpath refid="src.class.path"/>
    </javac>
  </target>

  <target name="compile-tests-web-onClient" depends="compile-web-onClient">
    <javac destdir="${build.dir}/tests/web/onClient" includes="**/*java" includeAntRuntime="false" debug="true" debuglevel="lines,vars,source" encoding="UTF-8">
      <src path="src/tests/web/onClient"/>
      <classpath refid="src.class.path"/>
    </javac>
  </target>

  <target name="package-tests-dao" depends="compile-tests-dao">
    <jar destfile="${jlib-tests.dir}/${app.name}-tests-dao.jar">
      <fileset dir="${build.dir}/tests/dao" includes="**/*.class"/>
    </jar>
  </target>
	
  <target name="package-tests-service" depends="compile-tests-service">
    <jar destfile="${jlib-tests.dir}/${app.name}-tests-service.jar">
      <fileset dir="${build.dir}/tests/service" includes="**/*.class"/>
    </jar>
  </target>
	
  <target name="package-tests-web-onServer" depends="compile-tests-web-onServer">
    <jar destfile="${jlib-tests.dir}/${app.name}-tests-web-onServer.jar">
      <fileset dir="${build.dir}/tests/web/onServer" includes="**/*.class"/>
    </jar>
  </target>

  <target name="package-tests-web-onClient" depends="compile-tests-web-onClient">
    <jar destfile="${jlib-tests.dir}/${app.name}-tests-web-onClient.jar">
      <fileset dir="${build.dir}/tests/web/onClient" includes="**/*.class"/>
    </jar>
  </target>
	
  <target name="run-tests-dao" depends="package-dao,package-tests-dao" if="junit.jar.present">
    <java fork="yes" classname="org.junit.runner.JUnitCore" taskname="junit" failonerror="true">
      <arg value="hr.fer.zemris.vhdllab.AllDAOJUnitTests"/>
      <classpath>
      	<pathelement location="${jlib.dir}/${app.name}-dao.jar"/>
        <pathelement location="${jlib-tests.dir}/${app.name}-tests-dao.jar"/>
        <pathelement location="${lib.dir}/junit.jar"/>
        <pathelement location="${java.class.path}"/>
      </classpath>
    </java>
  </target>
	
  <target name="run-tests-service" depends="package-dao,package-service,package-tests-service" if="junit.jar.present">
    <java fork="yes" classname="org.junit.runner.JUnitCore" taskname="junit" failonerror="true">
      <arg value="hr.fer.zemris.vhdllab.AllServiceJUnitTests"/>
      <classpath>
      	<pathelement location="${jlib.dir}/${app.name}-service.jar"/>
      	<pathelement location="${jlib.dir}/${app.name}-dao.jar"/>
        <pathelement location="${jlib-tests.dir}/${app.name}-tests-service.jar"/>
        <pathelement location="${lib.dir}/junit.jar"/>
        <pathelement location="${java.class.path}"/>
      </classpath>
    </java>
  </target>
     
  <target name="run-tests-web-onServer" depends="package-dao,package-service,package-web-onServer,package-tests-web-onServer" if="junit.jar.present">
    <java fork="yes" classname="org.junit.runner.JUnitCore" taskname="junit" failonerror="true">
      <arg value="hr.fer.zemris.vhdllab.AllOnServerJUnitTests"/>
      <classpath>
        <pathelement location="${jlib.dir}/${app.name}-web-onServer.jar"/>
      	<pathelement location="${jlib.dir}/${app.name}-service.jar"/>
      	<pathelement location="${jlib.dir}/${app.name}-dao.jar"/>
        <pathelement location="${jlib-tests.dir}/${app.name}-tests-web-onServer.jar"/>
        <pathelement location="${lib.dir}/junit.jar"/>
        <pathelement location="${java.class.path}"/>
      </classpath>
    </java>
  </target>
	
  <target name="run-tests-web-onClient" depends="package-dao,package-service,package-web-onClient,package-tests-web-onClient" if="junit.jar.present">
    <java fork="yes" classname="org.junit.runner.JUnitCore" taskname="junit" failonerror="true">
      <arg value="hr.fer.zemris.vhdllab.AllOnClientJUnitTests"/>
      <classpath>
        <pathelement location="${jlib.dir}/${app.name}-web-onClient.jar"/>
      	<pathelement location="${jlib.dir}/${app.name}-service.jar"/>
      	<pathelement location="${jlib.dir}/${app.name}-dao.jar"/>
        <pathelement location="${jlib-tests.dir}/${app.name}-tests-web-onClient.jar"/>
        <pathelement location="${lib.dir}/junit.jar"/>
        <pathelement location="${java.class.path}"/>
      </classpath>
    </java>
  </target>
	
  <target name="doc">
  	<javadoc access="public" author="true" classpath="libs/junit.jar;libs/plugin.jar;libs/servlet-api.jar"
  		destdir="${doc.dir}" nodeprecated="false" nodeprecatedlist="false" noindex="false" nonavbar="false" notree="false"
  		packagenames="*" source="1.5"
  		sourcepath="src/dao;src/service;src/web/onServer;src/web/OnClient"
  		splitindex="true" use="true" version="true">
	  <link href="http://java.sun.com/j2se/1.5.0/docs/api/"/>
	</javadoc>
  </target>
	
  <target name="doc-all">
  	<javadoc access="public" author="true" classpath="libs/junit.jar;libs/plugin.jar;libs/servlet-api.jar"
  		destdir="${doc.dir}" nodeprecated="false" nodeprecatedlist="false" noindex="false" nonavbar="false" notree="false"
  		packagenames="*" source="1.5"
  		sourcepath="src/dao;src/service;src/web/onServer;src/web/OnClient;src/tests/dao;src/tests/service;src/tests/web/onServer;src/tests/web/OnClient"
  		splitindex="true" use="true" version="true">
	  <link href="http://java.sun.com/j2se/1.5.0/docs/api/"/>
	</javadoc>
  </target>
	
  <target name="compile" depends="compile-dao,compile-service,compile-web-onServer,compile-web-onClient"/>

  <target name="package" depends="package-dao,package-service,package-web-onServer,package-web-onClient"/>

  <target name="package-tests" depends="package-tests-dao,package-tests-service,package-tests-web-onServer,package-tests-web-onClient"/>
	
  <target name="run-tests" depends="run-tests-dao,run-tests-service,run-tests-web-onServer,run-tests-web-onClient"/>
	
  <target name="all" depends="package,doc,run-tests"/>
	
  <target name="rebuild" depends="clean,package"/>
	
  <target name="rebuild-all" depends="clean,package,doc,run-tests"/>
	
  <target name="rebuild-doc" depends="clean,doc"/>
  	
  <target name="rebuild-doc-all" depends="clean,doc-all"/>
	
</project>